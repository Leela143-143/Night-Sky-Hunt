<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Night Sky Hunt Login</title>
    <style>
        /* --- ROOT STYLING & COLORS --- */
        :root {
            --dark-bg: #000000;
            --button-blue: #5ba6f8; /* Lighter, clearer blue from image */
            --button-hover: #7abeff;
            --text-color: #E6F1FF;
            --star-color: #FFFFFF;
            --gold: #FFD700; /* Added for consistency */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--dark-bg);
            color: var(--text-color);
            text-align: center;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center; /* Center content vertically */
            align-items: center;
        }

        /* --- Twinkling Stars Background (ENHANCED) --- */
        .stars {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; background: transparent;
            box-shadow: 
                -100vw -50vh var(--star-color), 100vw 100vh var(--star-color), 20vw 80vh var(--star-color), -80vw -20vh var(--star-color),
                40vw 10vh var(--star-color), 10vw 90vh var(--star-color), -50vw -10vh var(--star-color), 90vw -40vh var(--star-color);
            /* ACTIVATED ANIMATION */
            animation: twinkle 15s linear infinite alternate;
        }
        @keyframes twinkle { 
            0% { opacity: 0.1; }
            50% { opacity: 0.5; }
            100% { opacity: 0.2; }
        }

        /* --- TITLE STYLING (Gradient Text) --- */
        #mainTitle {
            font-size: 5em;
            font-weight: 800;
            margin-bottom: 70px; /* Space above buttons */
            background-image: linear-gradient(to right, #FF8C00, #FF007F, #9932CC); 
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 15px rgba(255, 100, 200, 0.4);
            letter-spacing: 2px;
        }

        /* --- MAIN CONTENT CONTAINER --- */
        .container {
            max-width: 90%; /* Use more screen space */
            width: 420px;
            padding: 30px 0;
            background: transparent;
            box-shadow: none;
        }
        
        #landingView .button-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            width: 100%;
            margin-top: 50px;
        }

        /* --- BUTTON STYLING --- */
        button, .landing-button {
            padding: 12px 25px;
            border-radius: 8px;
            border: none;
            color: white;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            width: auto;
        }

        .landing-button { background-color: var(--button-blue); }
        .landing-button:hover {
            background-color: var(--button-hover);
            transform: translateY(-1px);
        }
        
        .logout-btn { margin-top: 20px; }

        /* --- HUNT & LOGIN VIEW STYLING --- */
        #huntView, #loginView {
            background: rgba(42, 68, 148, 0.15);
            backdrop-filter: blur(5px);
            padding: 30px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.5);
        }
        
        #huntView input[type="number"], #loginView select {
             width: 90%; 
             padding: 14px; margin: 15px 0; border-radius: 8px; 
             border: none; box-sizing: border-box; font-size: 17px;
             background-color: rgba(255, 255, 255, 0.9); color: var(--dark-bg);
             font-weight: bold; text-align: center;
        }
        
        .team-prompt { font-size: 1.1em; font-weight: bold; color: var(--gold); margin-bottom: 10px; padding: 8px 0; border-bottom: 2px solid rgba(255, 199, 0, 0.3); display: block; }
        #teamIdSelect { background-color: rgba(255, 255, 255, 0.1); color: #E6F1FF; height: 60px; border: 1px solid var(--button-blue); padding: 5px; text-align: left; }
        #huntView button, #loginView button { background-color: #3f90ff; width: 100%; margin: 5px 0; }
        
        #result { margin-top: 20px; padding: 15px; border-radius: 8px; font-size: 1.1em; }
        .success { background-color: #03a062; }
        .error { background-color: #8f0d0d; }
        .coordinate-output { font-size: 1.8em; color: var(--gold); font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body onload="initializeData(); checkLoginStatus()">

<!-- Stars Background Layer -->
<div class="stars"></div>

<div class="container">
    <h1 id="mainTitle">Night Sky Hunt</h1>
    
    <!-- 1. LANDING VIEW -->
    <div id="landingView" style="display: none;">
        <div class="button-row">
            <button class="landing-button" onclick="showTeamLoginScreen()">Team Login</button>
        </div>
    </div>

    <!-- 2. LOGIN VIEW -->
    <div id="loginView" style="display: none;">
        <p>A coordinate awaits. Select your team to begin.</p>
        <div class="select-group">
            <span class="team-prompt">SELECT TEAM (1-20)</span> 
            <select id="teamIdSelect" size="6"></select>
        </div>
        <button onclick="loginTeam()">ENGAGE TRACKER</button>
        <button class="logout-btn" onclick="showLandingScreen()" style="background-color: #333;">Back</button>
    </div>

    <!-- 3. HUNT VIEW -->
    <div id="huntView" style="display: none;">
        <h2 id="teamGreeting"></h2>
        <label for="codeInput">Enter 4-Digit Validation Code:</label>
        <input type="number" id="codeInput" placeholder="â€¢â€¢â€¢â€¢" required>
        <button onclick="handleSubmission()">VALIDATE & RECALCULATE</button>
        <div id="result">Awaiting signal...</div>
        <button class="logout-btn" onclick="logoutTeam()" style="background-color: #555;">Logout / Reset Tracker</button>
    </div>
</div>

<script>
    // =================================================================
    // CONFIGURATION SECTION
    // =================================================================
    
    const NUM_TEAMS = 20;
    const NUM_QUESTIONS = 20;

    const questionsData = {
        "Q1":  { code: "3742", coords: "(9.7, 5.4)" },
        "Q2":  { code: "8169", coords: "(8.3, 10.9)" },
        "Q3":  { code: "2905", coords: "(9.1, 8.4)" },
        "Q4":  { code: "6471", coords: "(8.9, 6.0)" },
        "Q5":  { code: "5038", coords: "(6.0, 5.6)" },
        "Q6":  { code: "7294", coords: "(7.5, 12.6)" },
        "Q7":  { code: "1806", coords: "(3.5, 4.1)" },
        "Q8":  { code: "9532", coords: "(6.2, 10.1)" },
        "Q9":  { code: "4087", coords: "(7.8, 12.5)" },
        "Q10": { code: "6129", coords: "(6.5, 7.5)" },
        "Q11": { code: "3748", coords: "(5.3, 10.6)" },
        "Q12": { code: "5902", coords: "(9.0, 9.9)" },
        "Q13": { code: "8251", coords: "(2.1, 6.6)" },
        "Q14": { code: "4937", coords: "(10.9, 10.4)" },
        "Q15": { code: "1065", coords: "(7.5, 3.4)" },
        "Q16": { code: "7489", coords: "(7.3, 10.7)" },
        "Q17": { code: "2541", coords: "(4.8, 2.9)" },
        "Q18": { code: "6390", coords: "(10.1, 10)" },
        "Q19": { code: "4718", coords: "(4.4, 5.1)" },
        "Q20": { code: "8023", coords: "(10.3, 9)" },
        "Q_WIN": { code: "9999", coords: "ðŸŽ‰ HEAD TO THE FINISH LINEðŸŽ‰" }
    };

    const sequences = {
        "1": ["Q1", "Q14", "Q3", "Q11", "Q19", "Q2", "Q16", "Q5", "Q9", "Q7", "Q18", "Q8", "Q13", "Q4", "Q15", "Q10", "Q12", "Q17", "Q6", "Q20"],
        "2": ["Q5", "Q17", "Q2", "Q9", "Q14", "Q6", "Q1", "Q10", "Q8", "Q20", "Q3", "Q12", "Q4", "Q19", "Q15", "Q18", "Q13", "Q7", "Q11", "Q16"],
        "3": ["Q10", "Q3", "Q18", "Q7", "Q1", "Q8", "Q6", "Q19", "Q15", "Q5", "Q2", "Q16", "Q13", "Q17", "Q20", "Q4", "Q12", "Q14", "Q9", "Q11"],
        "4": ["Q14", "Q8", "Q16", "Q2", "Q19", "Q5", "Q13", "Q9", "Q6", "Q3", "Q11", "Q1", "Q10", "Q20", "Q7", "Q15", "Q4", "Q18", "Q12", "Q17"],
        "5": ["Q7", "Q1", "Q5", "Q18", "Q13", "Q2", "Q12", "Q16", "Q11", "Q8", "Q17", "Q4", "Q14", "Q9", "Q6", "Q19", "Q20", "Q10", "Q15", "Q3"],
        "6": ["Q2", "Q4", "Q10", "Q6", "Q7", "Q15", "Q18", "Q13", "Q1", "Q12", "Q8", "Q20", "Q16", "Q5", "Q14", "Q9", "Q3", "Q11", "Q17", "Q19"],
        "7": ["Q8", "Q11", "Q6", "Q19", "Q4", "Q14", "Q10", "Q1", "Q12", "Q2", "Q9", "Q17", "Q3", "Q15", "Q7", "Q13", "Q18", "Q20", "Q5", "Q16"],
        "8": ["Q16", "Q9", "Q14", "Q1", "Q11", "Q3", "Q19", "Q5", "Q7", "Q6", "Q18", "Q10", "Q2", "Q8", "Q20", "Q12", "Q15", "Q4", "Q17", "Q13"],
        "9": ["Q12", "Q18", "Q8", "Q13", "Q6", "Q10", "Q3", "Q7", "Q20", "Q11", "Q19", "Q5", "Q9", "Q2", "Q1", "Q16", "Q4", "Q15", "Q14", "Q17"],
        "10": ["Q3", "Q7", "Q11", "Q5", "Q18", "Q8", "Q17", "Q4", "Q1", "Q14", "Q6", "Q9", "Q15", "Q10", "Q13", "Q2", "Q12", "Q20", "Q19", "Q16"],
        "11": ["Q19", "Q6", "Q9", "Q3", "Q20", "Q1", "Q16", "Q15", "Q5", "Q18", "Q7", "Q14", "Q2", "Q13", "Q4", "Q11", "Q8", "Q10", "Q17", "Q12"],
        "12": ["Q9", "Q12", "Q19", "Q10", "Q3", "Q11", "Q8", "Q6", "Q2", "Q16", "Q15", "Q7", "Q20", "Q4", "Q5", "Q1", "Q14", "Q17", "Q18", "Q13"],
        "13": ["Q20", "Q15", "Q4", "Q8", "Q17", "Q9", "Q5", "Q14", "Q6", "Q7", "Q13", "Q19", "Q1", "Q16", "Q10", "Q18", "Q3", "Q2", "Q12", "Q11"],
        "14": ["Q11", "Q14", "Q17", "Q16", "Q12", "Q19", "Q2", "Q3", "Q13", "Q1", "Q5", "Q8", "Q18", "Q6", "Q9", "Q20", "Q15", "Q7", "Q10", "Q4"],
        "15": ["Q4", "Q16", "Q13", "Q20", "Q8", "Q17", "Q7", "Q2", "Q14", "Q9", "Q1", "Q3", "Q11", "Q10", "Q6", "Q5", "Q19", "Q12", "Q15", "Q18"],
        "16": ["Q13", "Q10", "Q1", "Q6", "Q17", "Q2", "Q15", "Q7", "Q19", "Q4", "Q20", "Q8", "Q16", "Q12", "Q9", "Q14", "Q3", "Q18", "Q5", "Q11"],
        "17": ["Q15", "Q5", "Q12", "Q14", "Q8", "Q4", "Q3", "Q20", "Q6", "Q1", "Q16", "Q7", "Q9", "Q19", "Q11", "Q10", "Q17", "Q13", "Q2", "Q18"],
        "18": ["Q6", "Q8", "Q15", "Q1", "Q9", "Q5", "Q2", "Q17", "Q13", "Q19", "Q10", "Q11", "Q7", "Q3", "Q16", "Q18", "Q20", "Q14", "Q4", "Q12"],
        "19": ["Q18", "Q7", "Q9", "Q11", "Q2", "Q3", "Q5", "Q12", "Q4", "Q13", "Q8", "Q6", "Q16", "Q20", "Q17", "Q10", "Q15", "Q14", "Q19", "Q1"],
        "20": ["Q17", "Q13", "Q20", "Q2", "Q4", "Q7", "Q9", "Q6", "Q5", "Q12", "Q14", "Q15", "Q10", "Q1", "Q19", "Q18", "Q8", "Q3", "Q11", "Q16"],
    };
    


    // --- 3. TEAM PROGRESS (Persistent) ---
    let teamProgress; // Will be loaded in initializeData

    // =================================================================
    // APPLICATION LOGIC
    // =================================================================
    
    function initializeData() {
        // ENHANCEMENT: Load progress from localStorage or set to default
        const savedProgress = localStorage.getItem('nightSkyHuntProgress');
        if (savedProgress) {
            teamProgress = JSON.parse(savedProgress);
        } else {
            teamProgress = {};
            for (let i = 1; i <= NUM_TEAMS; i++) teamProgress[i] = 0;
        }

        const teamSelect = document.getElementById('teamIdSelect');
        // Clear previous options before populating, to prevent duplicates
        teamSelect.innerHTML = '';
        for (let t = 1; t <= NUM_TEAMS; t++) {
            const option = document.createElement('option');
            option.value = t;
            option.textContent = `Team ${t}`;
            teamSelect.appendChild(option);
        }
    }

    // ENHANCEMENT: Add event listener for better input handling
    document.getElementById('codeInput').addEventListener('keyup', function(event) {
        if (this.value.length > 4) this.value = this.value.slice(0, 4);
        if (event.key === "Enter") {
            event.preventDefault();
            handleSubmission();
        }
    });

    function checkLoginStatus() {
        const teamId = localStorage.getItem('currentTeamId');
        if (teamId && teamProgress[teamId] !== undefined) {
            showHuntView(teamId);
        } else {
            showLandingScreen();
        }
    }

    function hideAllViews() {
        document.getElementById('landingView').style.display = 'none';
        document.getElementById('loginView').style.display = 'none';
        document.getElementById('huntView').style.display = 'none';
    }

    function showLandingScreen() {
        hideAllViews();
        document.getElementById('landingView').style.display = 'block';
        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = "Awaiting signal...";
        resultDiv.className = ''; // Reset class
    }
    
    function showTeamLoginScreen() {
        hideAllViews();
        document.getElementById('loginView').style.display = 'block';
    }

    function loginTeam() {
        const teamId = document.getElementById('teamIdSelect').value;
        if (teamId && sequences[teamId]) {
            localStorage.setItem('currentTeamId', teamId);
            showHuntView(teamId);
        } else {
            alert("Please select a valid team from the list.");
        }
    }

    function logoutTeam() {
        localStorage.removeItem('currentTeamId');
        showLandingScreen();
    }

    function updateGreeting(teamId) {
        const currentStep = teamProgress[teamId] + 1;
        const totalSteps = sequences[teamId].length;
        document.getElementById('teamGreeting').textContent = `Team ${teamId} | Step ${currentStep} / ${totalSteps}`;
    }

    function showHuntView(teamId) {
        hideAllViews();
        document.getElementById('huntView').style.display = 'block';
        updateGreeting(teamId);
    }

    function handleSubmission() {
        const teamId = localStorage.getItem('currentTeamId');
        const submittedCode = document.getElementById('codeInput').value;
        const resultDiv = document.getElementById('result');
        
        if (!teamId || submittedCode.length !== 4) {
            resultDiv.className = 'error';
            resultDiv.innerHTML = "SYSTEM ALERT: Invalid input or session error.";
            return;
        }

        const teamStepIndex = teamProgress[teamId];
        const teamSequence = sequences[teamId];
        
        if (teamStepIndex >= teamSequence.length) {
            resultDiv.className = 'success';
            resultDiv.innerHTML = `
                <p>MISSION COMPLETE!</p>
                <p class="coordinate-output">${questionsData['Q_WIN'].coords}</p>
            `;
            return;
        }

        const targetQuestionID = teamSequence[teamStepIndex];
        const expectedCode = questionsData[targetQuestionID].code;

        if (submittedCode === expectedCode) {
            // SUCCESS
            teamProgress[teamId]++;
            
            // ENHANCEMENT: Save progress to localStorage
            localStorage.setItem('nightSkyHuntProgress', JSON.stringify(teamProgress));
            
            const nextStepIndex = teamProgress[teamId];
            updateGreeting(teamId);

            if (nextStepIndex >= teamSequence.length) {
                resultDiv.className = 'success';
                resultDiv.innerHTML = `
                    <p>CODE ACCEPTED: MISSION COMPLETE!</p>
                    <p class="coordinate-output">${questionsData['Q_WIN'].coords}</p>
                `;
            } else {
                const nextTargetQuestionID = teamSequence[nextStepIndex];
                const nextCoords = questionsData[nextTargetQuestionID].coords;
                
                resultDiv.className = 'success';
                resultDiv.innerHTML = `
                    <p>TRANSMISSION RECEIVED. Next Target:</p>
                    <p class="coordinate-output">${nextCoords}</p>
                `;
            }
        } else {
            // FAILURE
            resultDiv.className = 'error';
            resultDiv.innerHTML = `
                <p>CODE REJECTED.</p>
                <p>Target lock failed. Re-verify coordinates and code.</p>
            `;
        }

        document.getElementById('codeInput').value = '';
        document.getElementById('codeInput').focus(); // Keep the input field active
    }
</script>

</body>
</html>
